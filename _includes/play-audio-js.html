<script>
document.addEventListener("DOMContentLoaded", function() {
    const audioPlayer = document.getElementById("audio-player");
    const playPauseBtn = document.getElementById("play-pause-btn");
    const progressBar = document.querySelector(".progress-bar");
    const currentTimeDisplay = document.getElementById("current-time");
    const durationDisplay = document.getElementById("duration");

    // Формируем путь к аудиофайлу из пермалинка
    const permalink = "{{ page.permalink }}";  // Jekyll-переменная для получения пермалинка
    audioPlayer.querySelector("source").src = `/assets/audio${permalink}.mp3`;
    audioPlayer.load();

    // Автоматическое воспроизведение с текущей минуты после загрузки метаданных
    audioPlayer.addEventListener("loadedmetadata", () => {
        const currentMinute = new Date().getMinutes();
        audioPlayer.currentTime = currentMinute * 60;  // Устанавливаем позицию на текущую минуту
        durationDisplay.textContent = formatTime(audioPlayer.duration);
        audioPlayer.play();
    });

    // Переключение воспроизведения
    const playPauseBtn = document.getElementById("play-pause-btn");
    const audioPlayer = document.getElementById("audio-player");

    // Функция переключения воспроизведения
    function togglePlayPause() {
        if (audioPlayer.paused) {
            audioPlayer.play();
            playPauseBtn.classList.remove("paused");
            playPauseBtn.classList.add("playing");
        } else {
            audioPlayer.pause();
            playPauseBtn.classList.remove("playing");
            playPauseBtn.classList.add("paused");
        }
    }

    // Обработчик клика по кнопке
    playPauseBtn.addEventListener("click", togglePlayPause);

    // Обработчик клика по любой части экрана
    document.addEventListener("click", (event) => {
        // Исключаем клик по кнопке, чтобы избежать двойного срабатывания
        if (event.target !== playPauseBtn) {
            togglePlayPause();
        }
    });

    // Обработчик нажатия клавиши (спейсбар)
    document.addEventListener("keydown", (event) => {
        if (event.code === "Space") {
            event.preventDefault(); // Предотвращаем прокрутку страницы
            togglePlayPause();
        }
    });

    // Обработчик движения мыши и скролла
    let mouseMoved = false;

    function handleMouseActivity() {
        if (audioPlayer.paused && !mouseMoved) {
            togglePlayPause();
            mouseMoved = true;
            // Сброс флага через 1 секунду, чтобы не повторялось при мелких движениях
            setTimeout(() => (mouseMoved = false), 1000);
        }
    }

    // Движение мыши
    document.addEventListener("mousemove", handleMouseActivity);

    // Скролл страницы
    document.addEventListener("scroll", handleMouseActivity);



    // Обновление прогресс-бара и текущего времени
    audioPlayer.addEventListener("timeupdate", () => {
        const progressPercent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        progressBar.style.width = `${progressPercent}%`;
        currentTimeDisplay.textContent = formatTime(audioPlayer.currentTime);
    });

    // Форматирование времени в минутах и секундах
    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs < 10 ? '0' + secs : secs}`;
    }
});
</script>
